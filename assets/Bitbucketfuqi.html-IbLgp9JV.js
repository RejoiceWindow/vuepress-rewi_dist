import{_ as l,c as i,b as n,d as e,w as t,a as o,r as c,o as u,e as p}from"./app-C5EA9484.js";const r="/assets/bitbucket_view001-W9jikRcb.png",d="/assets/bitbucket_update001-Bc4z55nN.png",k="/assets/bitbucket_update002-C-B1ENGo.png",v="/assets/bitbucket_update003-CfpqXKQc.png",m="/assets/bitbucket_update004-Bf6irTCU.png",b="/assets/bitbucket_new001-BWZIc6Z-.png",q="/assets/bitbucket_new002-DQBrE1aM.png",g="/assets/bitbucket_new003-oJdwcXbJ.png",h="/assets/bitbucket_new004-DEtoaK2j.png",y={},w={class:"table-of-contents"};function f(j,s){const a=c("router-link");return u(),i("div",null,[s[7]||(s[7]=n("h2",{id:"目录",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#目录"},[n("span",null,"目录")])],-1)),n("nav",w,[n("ul",null,[n("li",null,[e(a,{to:"#目录"},{default:t(()=>[...s[0]||(s[0]=[p("目录",-1)])]),_:1})]),n("li",null,[e(a,{to:"#文档"},{default:t(()=>[...s[1]||(s[1]=[p("文档",-1)])]),_:1})]),n("li",null,[e(a,{to:"#官方文档"},{default:t(()=>[...s[2]||(s[2]=[p("官方文档",-1)])]),_:1})]),n("li",null,[e(a,{to:"#查看"},{default:t(()=>[...s[3]||(s[3]=[p("查看",-1)])]),_:1})]),n("li",null,[e(a,{to:"#更新"},{default:t(()=>[...s[4]||(s[4]=[p("更新",-1)])]),_:1})]),n("li",null,[e(a,{to:"#新增"},{default:t(()=>[...s[5]||(s[5]=[p("新增：",-1)])]),_:1})]),n("li",null,[e(a,{to:"#数据库迁移"},{default:t(()=>[...s[6]||(s[6]=[p("数据库迁移",-1)])]),_:1})])])]),s[8]||(s[8]=o(`<h2 id="文档" tabindex="-1"><a class="header-anchor" href="#文档"><span>文档</span></a></h2><ul><li>https://confluence.atlassian.com/bitbucketserver/push-logs-998882984.html</li></ul><h2 id="官方文档" tabindex="-1"><a class="header-anchor" href="#官方文档"><span>官方文档</span></a></h2><ul><li>https://developer.atlassian.com/server/bitbucket/how-tos/updating-build-status-for-commits/</li><li>https://developer.atlassian.com/server/bitbucket/rest/v818/api-group-builds-and-deployments/#api-required-builds-latest-projects-projectkey-repos-repositoryslug-condition-id-put</li><li>https://docs.atlassian.com/bitbucket-server/rest/7.14.0/bitbucket-build-rest.html</li><li>https://docs.atlassian.com/bitbucket-server/rest/7.19.0-rc1/bitbucket-rest.html#idp228</li><li>https://developer.atlassian.com/server/bitbucket/reference/api-changelog/#bitbucket-data-center-8-18</li></ul><hr><ul><li>https://zhuanlan.zhihu.com/p/106946573</li><li>https://my.atlassian.com/products/index?sen=20124584&amp;evalId=20124584&amp;eval=true#license_20124584</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> pull docker.io/atlassian/bitbucket-server</span>
<span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-v</span> bitbucket:/var/atlassian/application-data/bitbucket <span class="token parameter variable">--name</span><span class="token operator">=</span><span class="token string">&quot;bitbucket&quot;</span> <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">7990</span>:7990 <span class="token parameter variable">-p</span> <span class="token number">7999</span>:7999 docker.io/atlassian/bitbucket-server</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查看" tabindex="-1"><a class="header-anchor" href="#查看"><span>查看</span></a></h2><img src="`+r+`" width="600"><div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;limit&quot;</span><span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;isLastPage&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;values&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="line">    <span class="token punctuation">{</span></span>
<span class="line">      <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;FAILED&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jenkins-6e074c42e3cce7db51fff92bdd8fb8a7&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://10.162.128.223:8888/job/BitbucketAutoBuild001/12/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token property">&quot;dateAdded&quot;</span><span class="token operator">:</span> <span class="token number">1698204441288</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;start&quot;</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span class="token comment"># bitbucketViewingBuildResults.py</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> requests<span class="token punctuation">.</span>auth <span class="token keyword">import</span> HTTPBasicAuth</span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token keyword">import</span> json</span>
<span class="line"></span>
<span class="line"><span class="token comment">########################################################################################################################</span></span>
<span class="line">bitbucketBaseUrl <span class="token operator">=</span> <span class="token string">&quot;192.168.121.128:7990&quot;</span></span>
<span class="line">commitHash <span class="token operator">=</span> <span class="token string">&quot;7cb9ee9cb4c9fd9667e27c2c0457cc1d3c5038e1&quot;</span></span>
<span class="line">userAuth <span class="token operator">=</span> HTTPBasicAuth<span class="token punctuation">(</span><span class="token string">&quot;ReWi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xu1314&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">########################################################################################################################</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">Viewing build results</span>
<span class="line">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line">url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span>bitbucketBaseUrl<span class="token punctuation">}</span></span><span class="token string">/rest/build-status/1.0/commits/</span><span class="token interpolation"><span class="token punctuation">{</span>commitHash<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将数据转换为JSON格式</span></span>
<span class="line"><span class="token comment"># json_data = json.dumps(data)</span></span>
<span class="line"></span>
<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span></span>
<span class="line">    url<span class="token operator">=</span>url<span class="token punctuation">,</span></span>
<span class="line">    headers<span class="token operator">=</span>headers<span class="token punctuation">,</span></span>
<span class="line">    auth<span class="token operator">=</span>userAuth<span class="token punctuation">,</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查响应</span></span>
<span class="line"><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;请求成功！&#39;</span><span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;响应内容:&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">,</span> sort_keys<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> separators<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;: &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;请求失败:&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line">    <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="更新" tabindex="-1"><a class="header-anchor" href="#更新"><span>更新</span></a></h2><img src="`+d+'" width="600"><img src="'+k+`" width="600"> - 时间戳转换工具： https://tool.lu/timestamp/ <div class="language-json line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre><code><span class="line"><span class="token punctuation">{</span></span>
<span class="line">  <span class="token property">&quot;state&quot;</span><span class="token operator">:</span> <span class="token string">&quot;SUCCESSFUL&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jenkins-6e074c42e3cce7db51fff92bdd8fb8a7&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://10.162.129.22:8888/job/PipelineTest002/11/&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Changed by ReWi manually&quot;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token property">&quot;dateAdded&quot;</span><span class="token operator">:</span> <span class="token number">1671618813000</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><img src="`+v+'" width="600"> 时间改不了： <img src="'+m+`" width="600"> Sure this manual process so it makes sense to automate the whole procedure. Well as at my employeer we mostly work on Windows machines, I’ve made a small powershell script. <div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span class="token comment"># bitbucketUpdatBuildResult.py</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> requests<span class="token punctuation">.</span>auth <span class="token keyword">import</span> HTTPBasicAuth</span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token keyword">import</span> json</span>
<span class="line"></span>
<span class="line"><span class="token comment">########################################################################################################################</span></span>
<span class="line">bitbucketBaseUrl <span class="token operator">=</span> <span class="token string">&quot;192.168.121.128:7990&quot;</span></span>
<span class="line">commitHash <span class="token operator">=</span> <span class="token string">&quot;7cb9ee9cb4c9fd9667e27c2c0457cc1d3c5038e1&quot;</span></span>
<span class="line">userAuth <span class="token operator">=</span> HTTPBasicAuth<span class="token punctuation">(</span><span class="token string">&quot;ReWi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xu1314&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">########################################################################################################################</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">Adding a build result to a commit</span>
<span class="line">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># To associate a build result with a particular commit, you need to POST a JSON object to the build status REST resource at:</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">https://&lt;bitbucket-base-url&gt;/rest/build-status/1.0/commits/&lt;commit-hash&gt;</span>
<span class="line">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span>bitbucketBaseUrl<span class="token punctuation">}</span></span><span class="token string">/rest/build-status/1.0/commits/</span><span class="token interpolation"><span class="token punctuation">{</span>commitHash<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token string">&quot;dateAdded&quot;</span><span class="token punctuation">:</span> <span class="token number">1671618813000</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;build-description&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;key&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;build-key-ReWiTest001&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;build-name&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;state&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;INPROGRESS&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://www.baidu.com&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将数据转换为 JSON 格式</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># json_data = json.dumps(data)</span></span>
<span class="line"></span>
<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span></span>
<span class="line">url<span class="token operator">=</span>url<span class="token punctuation">,</span></span>
<span class="line">headers<span class="token operator">=</span>headers<span class="token punctuation">,</span></span>
<span class="line">auth<span class="token operator">=</span>userAuth<span class="token punctuation">,</span></span>
<span class="line">json<span class="token operator">=</span>data<span class="token punctuation">,</span> <span class="token comment"># 使用 json 参数而不是 data 参数</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查响应</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">204</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;请求成功！&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;响应内容:&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;请求失败:&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># print(json.dumps(json.loads(response.text), sort_keys=True, indent=4, separators=(&quot;,&quot;, &quot;: &quot;)))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="新增" tabindex="-1"><a class="header-anchor" href="#新增"><span>新增：</span></a></h2><ol><li>获取参数 http://192.168.121.128:7990/projects/REWITEST/repos/gac-ah8-17.3/commits/7cb9ee9cb4c9fd9667e27c2c0457cc1d3c5038e1#README.md</li></ol><img src="`+b+`" width="600"><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># -*- coding: utf-8 -*-</span></span>
<span class="line"><span class="token comment"># bitbucketAddBuildResult.py</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">from</span> requests<span class="token punctuation">.</span>auth <span class="token keyword">import</span> HTTPBasicAuth</span>
<span class="line"><span class="token keyword">import</span> requests</span>
<span class="line"><span class="token keyword">import</span> json</span>
<span class="line"></span>
<span class="line"><span class="token comment">########################################################################################################################</span></span>
<span class="line">bitbucketBaseUrl <span class="token operator">=</span> <span class="token string">&quot;192.168.121.128:7990&quot;</span></span>
<span class="line">commitHash <span class="token operator">=</span> <span class="token string">&quot;7cb9ee9cb4c9fd9667e27c2c0457cc1d3c5038e1&quot;</span></span>
<span class="line">userAuth <span class="token operator">=</span> HTTPBasicAuth<span class="token punctuation">(</span><span class="token string">&quot;ReWi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;xu1314&quot;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token comment">########################################################################################################################</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&quot;&quot;&quot;</span>
<span class="line">Adding a build result to a commit</span>
<span class="line"></span>
<span class="line">&quot;state&quot;: &quot;&lt;INPROGRESS|SUCCESSFUL|FAILED&gt;&quot;,</span>
<span class="line">&quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># To associate a build result with a particular commit, you need to POST a JSON object to the build status REST resource at:</span></span>
<span class="line"></span>
<span class="line"><span class="token triple-quoted-string string">&#39;&#39;&#39;</span>
<span class="line">https://&lt;bitbucket-base-url&gt;/rest/build-status/1.0/commits/&lt;commit-hash&gt;</span>
<span class="line">&#39;&#39;&#39;</span></span>
<span class="line"></span>
<span class="line">url <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f&quot;http://</span><span class="token interpolation"><span class="token punctuation">{</span>bitbucketBaseUrl<span class="token punctuation">}</span></span><span class="token string">/rest/build-status/1.0/commits/</span><span class="token interpolation"><span class="token punctuation">{</span>commitHash<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span></span>
<span class="line"></span>
<span class="line">headers <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;application/json&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">data <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="line"><span class="token string">&quot;state&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;FAILED&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;key&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;build-key-ReWiTest002&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;build-name&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;url&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;https://www.baidu.com&quot;</span><span class="token punctuation">,</span></span>
<span class="line"><span class="token string">&quot;description&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;build-description&quot;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 将数据转换为 JSON 格式</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># json_data = json.dumps(data)</span></span>
<span class="line"></span>
<span class="line">response <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span></span>
<span class="line">url<span class="token operator">=</span>url<span class="token punctuation">,</span></span>
<span class="line">headers<span class="token operator">=</span>headers<span class="token punctuation">,</span></span>
<span class="line">auth<span class="token operator">=</span>userAuth<span class="token punctuation">,</span></span>
<span class="line">json<span class="token operator">=</span>data<span class="token punctuation">,</span> <span class="token comment"># 使用 json 参数而不是 data 参数</span></span>
<span class="line"><span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># 检查响应</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">if</span> response<span class="token punctuation">.</span>status_code <span class="token operator">==</span> <span class="token number">204</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;请求成功！&#39;</span><span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;响应内容:&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">else</span><span class="token punctuation">:</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">&#39;请求失败:&#39;</span><span class="token punctuation">,</span> response<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span></span>
<span class="line"><span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span></span>
<span class="line"></span>
<span class="line"><span class="token comment"># print(json.dumps(json.loads(response.text), sort_keys=True, indent=4, separators=(&quot;,&quot;, &quot;: &quot;)))</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>效果： <img src="`+q+'" width="600"><img src="'+g+'" width="600"><img src="'+h+`" width="600"></li></ol><h2 id="数据库迁移" tabindex="-1"><a class="header-anchor" href="#数据库迁移"><span>数据库迁移</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 进入postgres容器</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> postgres <span class="token function">bash</span></span>
<span class="line"><span class="token comment"># 将当前root切换成postgres</span></span>
<span class="line"><span class="token function">su</span> postgres</span>
<span class="line"><span class="token comment"># 输入用户名，密码再命令执行完后，再根据提示输入</span></span>
<span class="line">psql <span class="token parameter variable">-U</span> postgres <span class="token parameter variable">-W</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>https://optimizory.atlassian.net/wiki/spaces/rmsis/pages/284849/Database+Setup</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">CREATE DATABASE bitbucket WITH ENCODING <span class="token string">&#39;UNICODE&#39;</span><span class="token punctuation">;</span></span>
<span class="line">createdb <span class="token parameter variable">-E</span> UNICODE bitbucket</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>https://www.runoob.com/postgresql/postgresql-drop-database.html</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">DROP DATABASE bitbucket<span class="token punctuation">;</span></span>
<span class="line"><span class="token comment"># dropdb rmsis</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>https://www.runoob.com/postgresql/postgresql-privileges.html</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 创建一个用户：</span></span>
<span class="line">CREATE <span class="token environment constant">USER</span> admin WITH PASSWORD <span class="token string">&#39;xu1314&#39;</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment"># 删除用户</span></span>
<span class="line">DROP <span class="token environment constant">USER</span> admin<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">GRANT ALL PRIVILEGES ON DATABASE bitbucket TO admin<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>`,35))])}const T=l(y,[["render",f]]),x=JSON.parse('{"path":"/blogs/developer/backend/Bitbucketfuqi.html","title":"Bitbucket服務器","lang":"zh-CN","frontmatter":{"title":"Bitbucket服務器","date":"2024-06-09T19:30:00.000Z","tags":["仓库服务器","bitbucket","web"],"categories":["backend"]},"headers":[{"level":2,"title":"目录","slug":"目录","link":"#目录","children":[]},{"level":2,"title":"文档","slug":"文档","link":"#文档","children":[]},{"level":2,"title":"官方文档","slug":"官方文档","link":"#官方文档","children":[]},{"level":2,"title":"查看","slug":"查看","link":"#查看","children":[]},{"level":2,"title":"更新","slug":"更新","link":"#更新","children":[]},{"level":2,"title":"新增：","slug":"新增","link":"#新增","children":[]},{"level":2,"title":"数据库迁移","slug":"数据库迁移","link":"#数据库迁移","children":[]}],"git":{"createdTime":1759387174000,"updatedTime":1769075498000,"contributors":[{"name":"ReWi","email":"RejoiceWindow@yeah.com","commits":3}]},"filePathRelative":"blogs/developer/backend/Bitbucket服務器.md"}');export{T as comp,x as data};
