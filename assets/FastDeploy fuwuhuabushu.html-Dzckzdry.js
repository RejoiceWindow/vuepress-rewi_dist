import{_ as n,c as a,a as e,o as l}from"./app-C5EA9484.js";const i={};function p(t,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="fastdeploy-服务化部署" tabindex="-1"><a class="header-anchor" href="#fastdeploy-服务化部署"><span>FastDeploy 服务化部署</span></a></h1><h2 id="文件夹准备" tabindex="-1"><a class="header-anchor" href="#文件夹准备"><span>文件夹准备</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">mkdir</span> PaddlePaddle</span>
<span class="line"><span class="token builtin class-name">cd</span> PaddlePaddle</span>
<span class="line"><span class="token function">mkdir</span> FastDeploy</span>
<span class="line"><span class="token builtin class-name">cd</span> FastDeploy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="文件下载" tabindex="-1"><a class="header-anchor" href="#文件下载"><span>文件下载</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token comment"># 下载仓库代码</span></span>
<span class="line"><span class="token comment"># 下载部署示例代码</span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/PaddlePaddle/FastDeploy.git</span>
<span class="line"><span class="token builtin class-name">cd</span>  FastDeploy/examples/vision/ocr/PP-OCR/serving/fastdeploy_serving</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 如果您希望从PaddleOCR下载示例代码，请运行</span></span>
<span class="line"><span class="token function">git</span> clone https://github.com/PaddlePaddle/PaddleOCR.git</span>
<span class="line"><span class="token comment"># 注意：如果当前分支找不到下面的fastdeploy测试代码，请切换到dygraph分支</span></span>
<span class="line"><span class="token function">git</span> checkout dygraph</span>
<span class="line"><span class="token builtin class-name">cd</span> PaddleOCR/deploy/fastdeploy/serving/fastdeploy_serving</span>
<span class="line"></span>
<span class="line"><span class="token comment"># 下载模型,图片和字典文件</span></span>
<span class="line"><span class="token function">wget</span> https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_det_infer.tar</span>
<span class="line"><span class="token function">tar</span> xvf ch_PP-OCRv3_det_infer.tar <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ch_PP-OCRv3_det_infer <span class="token number">1</span></span>
<span class="line"><span class="token function">mv</span> <span class="token number">1</span>/inference.pdiparams <span class="token number">1</span>/model.pdiparams <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> <span class="token number">1</span>/inference.pdmodel <span class="token number">1</span>/model.pdmodel</span>
<span class="line"><span class="token function">mv</span> <span class="token parameter variable">-b</span> <span class="token number">1</span> models/det_runtime/ <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> ch_PP-OCRv3_det_infer.tar</span>
<span class="line"></span>
<span class="line"><span class="token function">wget</span> https://paddleocr.bj.bcebos.com/dygraph_v2.0/ch/ch_ppocr_mobile_v2.0_cls_infer.tar</span>
<span class="line"><span class="token function">tar</span> xvf ch_ppocr_mobile_v2.0_cls_infer.tar <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ch_ppocr_mobile_v2.0_cls_infer <span class="token number">1</span></span>
<span class="line"><span class="token function">mv</span> <span class="token number">1</span>/inference.pdiparams <span class="token number">1</span>/model.pdiparams <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> <span class="token number">1</span>/inference.pdmodel <span class="token number">1</span>/model.pdmodel</span>
<span class="line"><span class="token function">mv</span> <span class="token parameter variable">-b</span> <span class="token number">1</span> models/cls_runtime/ <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> ch_ppocr_mobile_v2.0_cls_infer.tar</span>
<span class="line"></span>
<span class="line"><span class="token function">wget</span> https://paddleocr.bj.bcebos.com/PP-OCRv3/chinese/ch_PP-OCRv3_rec_infer.tar</span>
<span class="line"><span class="token function">tar</span> xvf ch_PP-OCRv3_rec_infer.tar <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> ch_PP-OCRv3_rec_infer <span class="token number">1</span></span>
<span class="line"><span class="token function">mv</span> <span class="token number">1</span>/inference.pdiparams <span class="token number">1</span>/model.pdiparams <span class="token operator">&amp;&amp;</span> <span class="token function">mv</span> <span class="token number">1</span>/inference.pdmodel <span class="token number">1</span>/model.pdmodel</span>
<span class="line"><span class="token function">mv</span> <span class="token parameter variable">-b</span> <span class="token number">1</span> models/rec_runtime/ <span class="token operator">&amp;&amp;</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> ch_PP-OCRv3_rec_infer.tar</span>
<span class="line"></span>
<span class="line"><span class="token function">mkdir</span> models/pp_ocr/1 <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> models/rec_pp/1 <span class="token operator">&amp;&amp;</span> <span class="token function">mkdir</span> models/cls_pp/1</span>
<span class="line"></span>
<span class="line"><span class="token function">wget</span> https://gitee.com/paddlepaddle/PaddleOCR/raw/release/2.6/ppocr/utils/ppocr_keys_v1.txt</span>
<span class="line"><span class="token function">mv</span> ppocr_keys_v1.txt models/rec_postprocess/1/</span>
<span class="line"></span>
<span class="line"><span class="token function">wget</span> https://gitee.com/paddlepaddle/PaddleOCR/raw/release/2.6/doc/imgs/12.jpg</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cpu-镜像" tabindex="-1"><a class="header-anchor" href="#cpu-镜像"><span>CPU 镜像</span></a></h2><p>CPU 镜像仅支持 Paddle/ONNX 模型在 CPU 上进行服务化部署，支持的推理后端包括 OpenVINO、Paddle Inference 和 ONNX Runtime</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> pull registry.baidubce.com/paddlepaddle/fastdeploy:1.0.7-cpu-only-21.10</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="使用服务化-docker" tabindex="-1"><a class="header-anchor" href="#使用服务化-docker"><span>使用服务化 Docker</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> run <span class="token parameter variable">-dit</span> <span class="token parameter variable">--net</span><span class="token operator">=</span>host <span class="token parameter variable">--name</span> fastdeploy --shm-size<span class="token operator">=</span><span class="token string">&quot;1g&quot;</span> <span class="token parameter variable">-v</span> <span class="token environment constant">$PWD</span>:/ocr_serving registry.baidubce.com/paddlepaddle/fastdeploy:1.0.7-cpu-only-21.10 <span class="token function">bash</span></span>
<span class="line"><span class="token function">sudo</span> <span class="token function">docker</span> <span class="token builtin class-name">exec</span> <span class="token parameter variable">-it</span> <span class="token parameter variable">-u</span> root fastdeploy <span class="token function">bash</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="服务端的使用" tabindex="-1"><a class="header-anchor" href="#服务端的使用"><span>服务端的使用</span></a></h2><h3 id="安装-在-docker-内" tabindex="-1"><a class="header-anchor" href="#安装-在-docker-内"><span>安装(在 docker 内)</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">ldconfig</span>
<span class="line"><span class="token function">apt-get</span> <span class="token function">install</span> libgl1</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置修改" tabindex="-1"><a class="header-anchor" href="#配置修改"><span>配置修改</span></a></h3><p>当前默认配置在 GPU 上运行， 如果要在 CPU 或其他推理引擎上运行。 需要修改 models/runtime/config.pbtxt 中配置</p><ul><li>参考： https://blog.csdn.net/qq_30946821/article/details/131408693</li><li>https://github.com/PaddlePaddle/FastDeploy/blob/develop/serving/docs/zh_CN/model_configuration.md</li></ul><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">instance_group <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># The number of instances is 1</span></span>
<span class="line">    count: <span class="token number">1</span></span>
<span class="line">    <span class="token comment"># Use GPU, CPU inference option is:KIND_CPU</span></span>
<span class="line">    kind: KIND_GPU</span>
<span class="line">    <span class="token comment"># The instance is deployed on the 0th GPU card</span></span>
<span class="line">    gpus: <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span>
<span class="line">改为</span>
<span class="line">instance_group <span class="token punctuation">[</span></span>
<span class="line">  <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment"># The number of instances is 1</span></span>
<span class="line">    count: <span class="token number">1</span></span>
<span class="line">    <span class="token comment"># Use GPU, CPU inference option is:KIND_CPU</span></span>
<span class="line">    kind: KIND_CPU</span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动服务端-在-docker-内" tabindex="-1"><a class="header-anchor" href="#启动服务端-在-docker-内"><span>启动服务端(在 docker 内)</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">fastdeployserver --model-repository<span class="token operator">=</span>/ocr_serving/models</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>参数:</p><p>model-repository(required): 整套模型 streaming_pp_tts 存放的路径. http-port(optional): HTTP 服务的端口号. 默认: 8000. 本示例中未使用该端口. grpc-port(optional): GRPC 服务的端口号. 默认: 8001. metrics-port(optional): 服务端指标的端口号. 默认: 8002. 本示例中未使用该端口.</p><h1 id="客户端的使用" tabindex="-1"><a class="header-anchor" href="#客户端的使用"><span>客户端的使用</span></a></h1><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装"><span>安装</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">pip <span class="token function">install</span> tritonclient<span class="token punctuation">[</span>all<span class="token punctuation">]</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="发送请求" tabindex="-1"><a class="header-anchor" href="#发送请求"><span>发送请求</span></a></h2><div class="language-python line-numbers-mode" data-highlighter="prismjs" data-ext="py" data-title="py"><pre><code><span class="line"><span class="token comment"># client.py</span></span>
<span class="line"><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="serving-可视化部署" tabindex="-1"><a class="header-anchor" href="#serving-可视化部署"><span>Serving 可视化部署</span></a></h1><h2 id="在容器中使用如下命令可以安装-visualdl" tabindex="-1"><a class="header-anchor" href="#在容器中使用如下命令可以安装-visualdl"><span>在容器中使用如下命令可以安装 VisualDL</span></a></h2><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> pip</span>
<span class="line">python3 <span class="token parameter variable">-m</span> pip <span class="token function">install</span> <span class="token parameter variable">--upgrade</span> visualdl<span class="token operator">&gt;=</span><span class="token number">2.5</span>.0 --root-user-action<span class="token operator">=</span>ignore mediapipe</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用方式" tabindex="-1"><a class="header-anchor" href="#使用方式"><span>使用方式</span></a></h2><p>使用命令</p><p>接着在浏览器打开http://127.0.0.1:8080（如果浏览器和启动visualdl的机器不同，请替换为启动visualdl机器的ip），即可以看到FastDeploy Server 的功能选项卡。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line">visualdl <span class="token parameter variable">--host</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">--port</span> <span class="token number">8090</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="功能说明" tabindex="-1"><a class="header-anchor" href="#功能说明"><span>功能说明</span></a></h2><p>VisualDL 的 Serving 可视化部署功能主要提供模型库载入和编辑、serving 管理监控这两方面的功能。 下面以 examples 目录为示例进行功能说明，可以先通过下列命令来获取示例所需要的资源并开启 visualdl。</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre><code><span class="line"><span class="token function">git</span> clone https://github.com/PaddlePaddle/FastDeploy.git</span>
<span class="line"><span class="token builtin class-name">cd</span> FastDeploy/examples</span>
<span class="line">visualdl <span class="token parameter variable">--host</span> <span class="token number">0.0</span>.0.0 <span class="token parameter variable">--port</span> <span class="token number">8080</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>进入 FastDeployServer 的功能选项卡后，</p>`,37)])])}const r=n(i,[["render",p]]),d=JSON.parse('{"path":"/blogs/developer/python/FastDeploy fuwuhuabushu.html","title":"FastDeploy 服务化部署","lang":"zh-CN","frontmatter":{"title":"FastDeploy 服务化部署","date":"2024-09-19T17:00:00.000Z","tags":["web"],"categories":["Python"]},"headers":[{"level":2,"title":"文件夹准备","slug":"文件夹准备","link":"#文件夹准备","children":[]},{"level":2,"title":"文件下载","slug":"文件下载","link":"#文件下载","children":[]},{"level":2,"title":"CPU 镜像","slug":"cpu-镜像","link":"#cpu-镜像","children":[]},{"level":2,"title":"使用服务化 Docker","slug":"使用服务化-docker","link":"#使用服务化-docker","children":[]},{"level":2,"title":"服务端的使用","slug":"服务端的使用","link":"#服务端的使用","children":[{"level":3,"title":"安装(在 docker 内)","slug":"安装-在-docker-内","link":"#安装-在-docker-内","children":[]},{"level":3,"title":"配置修改","slug":"配置修改","link":"#配置修改","children":[]},{"level":3,"title":"启动服务端(在 docker 内)","slug":"启动服务端-在-docker-内","link":"#启动服务端-在-docker-内","children":[]}]},{"level":2,"title":"安装","slug":"安装","link":"#安装","children":[]},{"level":2,"title":"发送请求","slug":"发送请求","link":"#发送请求","children":[]},{"level":2,"title":"在容器中使用如下命令可以安装 VisualDL","slug":"在容器中使用如下命令可以安装-visualdl","link":"#在容器中使用如下命令可以安装-visualdl","children":[]},{"level":2,"title":"使用方式","slug":"使用方式","link":"#使用方式","children":[]},{"level":2,"title":"功能说明","slug":"功能说明","link":"#功能说明","children":[]}],"git":{"createdTime":1759387174000,"updatedTime":1769075498000,"contributors":[{"name":"ReWi","email":"RejoiceWindow@yeah.com","commits":3}]},"filePathRelative":"blogs/developer/python/FastDeploy 服务化部署.md"}');export{r as comp,d as data};
